---
title: "Statistical modelling"
author: "Léo Belzile, HEC Montréal"
subtitle: "01. Statistical Inference"
date: today
date-format: YYYY
eval: true
cache: true
echo: true
standalone: true
bibliography: MATH60604A.bib
format:
  revealjs:
    slide-number: true
    preview-links: auto
    theme: [simple, hecmontreal.scss]
    title-slide-attributes:
      data-background-color: "#002855"
    logo: "fig/logo_hec_montreal_bleu_web.png"
    width: 1200
    height: 900
---


```{r}
#| eval: true
#| include: false
#| cache: false
hecbleu <- c("#002855")
fcols <- c(gris = "#888b8d",
           bleu = "#0072ce",
           aqua = "#00aec7",
           vert = "#26d07c",
           rouge = "#ff585d",
           rose = "#eb6fbd",
           jaune = "#f3d03e")
pcols <- c(gris = "#d9d9d6",
           bleu = "#92c1e9",
           agua = "#88dbdf",
           vert = "#8fe2b0",
           rouge = "#ffb1bb",
           rose = "#eab8e4",
           jaune = "#f2f0a1")
library(ggplot2)
theme_set(theme_classic())
library(patchwork)
knitr::opts_chunk$set(fig.retina = 3, collapse = TRUE)
options(digits = 3, width = 75)
```


## Why use models?

A famous quote attributed to George Box claims that

> All models are wrong, but some are useful.

Peter McCullagh and John Nelder wrote in the preamble of their book (emphasis mine)

> Modelling in science remains, partly at least, an art. Some principles do exist, however, to guide the modeller. The first is that all models are wrong; **some, though, are better** than others and we can **search for the better ones**. At the same time we must recognize that eternal truth is not within our grasp.

## More insights on modelling

This quote by David R. Cox adds to the point:

> ...it does not seem helpful just to say that all models are wrong. The very word model implies simplification and idealization. The idea that complex physical, biological or sociological systems can be exactly described by a few formulae is patently absurd. The construction of idealized representations that **capture important stable aspects of such systems** is, however, a vital part of general scientific analysis and statistical models, especially substantive ones, do not seem essentially different from other kinds of model.


# Motivating examples {background-color="#002855"}

## 1. Driving exams in Great Britain

Are driving tests easier if you live in a rural area? Source: [The Guardian, August 23rd, 2019](https://www.theguardian.com/world/2019/aug/23/an-easy-ride-scottish-village-fuels-debate-driving-test-pass-rates)

:::: {.columns}

::: {.column width="50%"}
```{r}
#| eval: true
#| echo: false
#| out-width: '100%'
knitr::include_graphics("fig/01/guardian_driving.png")
```

:::


::: {.column width="50%"}
```{r}
#| eval: true
#| echo: false
#| out-width: '100%'
knitr::include_graphics("fig/01/guardian_driving_infographic.png")
```

:::

::::

Model: binomial logistic model. Data `gbdriving`, **R** package `hecstatmod`.



<!--
## Motivating examples - smartwatches are distracting.

Eye tracking gaze distribution results show that participants were more distracted in the smartwatch condition than in the mobile phone condition, they were less distracted in the speaker condition than in the phone condition, and they were more distracted in the texting condition than in any of the others.
-->

## 2. Road safety and distraction due to smartwatches {.smaller}

:::: {.columns}

::: {.column width="50%"}
```{r}
#| eval: true
#| echo: false
#| out-width: '100%'
knitr::include_graphics("fig/01/smartwatches.png")
```


Models: Within-subject ANOVA (repeated measures) with pairwise paired t-tests or nonparametric tests (Friedman + Wilcoxon signed-rank test). Dataset `BRLS21_T3`, package `hecedsm`.

:::


::: {.column width="50%"}

@Brodeur:2021

> A within-subject experiment was conducted in a driving simulator where 31 participants received and answered text messages under four conditions: they received notifications (1) on a mobile phone, (2) on a smartwatch, and (3) on a speaker, and then responded orally to these messages. They also (4) received messages in a “texting” condition where they had to reply through text to the notifications. 

:::

::::

## 3. Perceived environmental friendliness of packages {.smaller}

:::: {.columns}

::: {.column width="50%"}
```{r}
#| eval: true
#| echo: false
#| out-width: '100%'
knitr::include_graphics("fig/01/package-paper-plastic.png")
```

:::


::: {.column width="40%"}
@Sokolova:2023

> Eight studies (N = 4103) document the perceived environmental friendliness (PEF) bias whereby consumers judge plastic packaging with additional paper to be more environmentally friendly than identical plastic packaging without the paper.

:::

::::

Model: linear regression/ANOVA with custom contrasts. Dataset `SKD23_S2A`, package `hecedsm`

## 4. A/B tests and news headlines {.smaller}


:::: {.columns}

::: {.column width="60%"}
```{r}
#| eval: true
#| echo: false
#| out-width: '100%'
knitr::include_graphics("fig/01/upworthy.png")
```

:::


::: {.column width="40%"}
Upworthy.com, a US media publisher, revolutionized headlines online advertisement by running systematic A/B tests to compare the different wording of headlines, placement of text and image to figure out what catches attention the most. 

The Upworthy Research Archive [@Matias:2021] contains results for 22743 experiments, with a click through rate of 1.58% on average and a standard deviation of 1.23%.
:::

::::

Model: Poisson regression with offset. Data `upworthy_sesame`, package `hecbayes`.




## 5. Impact of videoconferencing on idea generation  {.smaller}




:::: {.columns}

::: {.column width="40%"}
```{r}
#| eval: true
#| echo: false
#| out-width: '80%'
knitr::include_graphics("fig/01/Brucks_Levav-virtual_communications.png")
```

:::


::: {.column width="60%"}

@Brucks.Levav:2022

> In a laboratory study and a field experiment across five countries (in Europe, the Middle East and South Asia), we show that videoconferencing inhibits the production of creative ideas [...]  

> we demonstrate that videoconferencing hampers idea generation because it focuses communicators on a screen, which prompts a narrower cognitive focus. Our results suggest that virtual interaction comes with a cognitive cost for creative idea generation.


:::

::::

- Model: Linear regression with compound symmetry covariance/MANOVA. Dataset `BL22_E`, package `hecedsm`
- Model: Binomial regression, dataset `BL22_L` from package `hecedsm`.

## 6. Suggesting amounts for donations {.smaller}


:::: {.columns}

::: {.column width="50%"}

@Moon.VanEpps:2023

> Across seven studies, we provide evidence that quantity requests, wherein people consider multiple choice options of how much to donate (e.g., $5, $10, or $15), increase contributions compared to open-ended requests. 


> Our findings offer new conceptual insights into how quantity requests increase contributions as well as practical implications for charitable organizations to optimize contributions by leveraging the use of quantity requests.

:::

::: {.column width="50%"}

```{r}
#| eval: true
#| echo: false
#| out-width: '100%'
knitr::include_graphics("fig/01/Moon_VanEpps-giving.png")
```

:::

::::

Model: Tobit type II regression and Poisson regression (independence test), data `MV23_S1` from package `hecedsm`.

## 7. Integrated decisions in online shopping {.smaller}

:::: {.columns}

::: {.column width="60%"}

@Duke.Amir:2023

> Customers must often decide on the quantity to purchase in addition to whether to purchase. The current research introduces and compares the quantity-sequential selling format, in which shoppers resolve the purchase and quantity decisions separately, with the quantity-integrated selling format, where shoppers simultaneously consider whether and how many to buy. Although retailers often use the sequential format, we demonstrate that the integrated format can increase purchase rates.

:::

::: {.column width="40%"}

```{r}
#| eval: true
#| echo: false
#| out-width: '100%'
knitr::include_graphics("fig/01/Duke_Amir.png")
```

> A field experiment conducted with a large technology firm found that quantity integration yielded considerably higher sales, amounting to an increase of more than $1 million in annual revenue. 

:::

::::

Model: logistic regression, dataset `DA23_E1`.

## 8. Price of oil in the Gaspe Peninsula



:::: {.columns}

::: {.column width="50%"}

Mayors requested  an inquiry by the [**Régie de l'énergie**](https://www.regie-energie.qc.ca/fr), a regulating agency in charge of energy prices. The report found that prices were indeed more expensive, but pointed out that there were more retailers per capita, and lower volume so their margins were higher.

Source: Radio-Canada [1](https://ici.radio-canada.ca/nouvelle/1303956/prix-essence-gaspe-enquete), [2](https://ici.radio-canada.ca/nouvelle/1463520/prix-essence-gaspesie-rapport-regie-energie)
:::

::: {.column width="50%"}

```{r}
#| eval: true
#| echo: false
#| out-width: '100%'
knitr::include_graphics("fig/01/regieenergie.png")
```

:::

::::

Model: Linear regression with autoregressive errors, pairwise comparisons. Dataset `renergy`, package `hecstatmod`.




# Hypothesis testing {background-color="#002855"}

## Hypothesis testing as a trial analogy

```{r}
#| label: fig-twelveangrymen
#| echo: false
#| out-width: '65%'
#| fig-cap: "Screenshot of the courtoom drama _Twelve Angry Men_ (1957)"
knitr::include_graphics('fig/01/12_Angry_Men_scene.jpg')
```

## Hypothesis test recipe

An hypothesis test is a binary decision rule (reject/fail to reject)

Below are the different steps to undertake:


1. Define the variables of interest.
2. Formulate the alternative and the null hypotheses, $\mathscr{H}_a$ and $\mathscr{H}_0$.
3. Choose the test statistic and compute the latter on the sample.
4. Compare the numerical value with the null distribution.
5. Obtain the *p*-value or a confidence interval.
6. Conclude in the setting of the problem.


## Texting while walking: a dangerous habit?

Tech3Lab, HEC Montreal's User Experience (UX) lab, studied the impact of texting on distraction.

```{r}
#| label: tech3lab
#| echo: false
#| out-width: '85%'
knitr::include_graphics('fig/01/Tech3Lab-texter.jpg')
```


## Study details

- 35 participants took part in the study.
- Each person had to walk on a treadmill in front of a screen where obstacles were projected.
- In one of the sessions, the subjects walked while talking on a cell
phone, whereas in another session, they walked while texting.
- The order of these sessions was determined *at random*.
- Different obstacles were randomly projected during the session.
- We are only interested in one kind of scenario: a cyclist riding towards the participant.

## Characteristics

- Population: adults
- Sample: 35 individuals (convenience sample, recruited)
- Variables:
  - Time to perceive an obstacle: quantitative
  - Distraction type (cellphone call or texting): nominal variable
- Response variable: time (in seconds) that it takes for a person to notice the obstacle when walking while texting or talking on a cell phone (measured through an encephalogram)


## 1. Define the variables of interest

- Let $\mu_{\texttt{c}}$ be the average reaction time (in seconds) during a call (`c`)
- and let $\mu_{\texttt{t}}$ be the average reaction time (in seconds) while texting (`t`)



## 2. Formulate the null and alternative hypothesis

- Hypothesis of interest (alternative): does texting increases distraction?
    - $\mathscr{H}_a: \mu_{\texttt{t}} > \mu_{\texttt{c}}$ (one-sided)
- Null hypothesis (Devil's advocate)
    - $\mathscr{H}_0: \mu_{\texttt{t}} \leq  \mu_{\texttt{c}}$

Express the hypothesis in terms of the difference of means
\begin{align*}
\mathscr{H}_a: \mu_{\texttt{t}} - \mu_{\texttt{c}}>0.
\end{align*}


## 3.Choose the test statistic

We compare the difference of the mean reaction time

- one-sample _t_-test for $\texttt{t}-\texttt{c}$ (paired _t_-test)
\begin{align*}
T_D=\frac{\overline{D}-\mu_0}{\mathsf{se}(\overline{D})}
\end{align*}
- $\overline{D}$ is the mean difference in the sample.
- Under $\mathscr{H}_0: \mu_0=\mu_{\texttt{t}}-\mu_{\texttt{c}}=0$.
- The standard error of $\overline{D}$ is $\mathsf{se}(\overline{D})=S_D/\sqrt{n}$, where $S_D$ is the standard deviation of the variables $D_i$ and $n$ the sample size.

## **R** code

```{r}
#| label: distraction_code
#| eval: true
#| echo: true
data(distraction, package = "hecstatmod")
ttest <- with(distraction,
     t.test(x = t,
            y = c, 
            paired = TRUE, 
            alternative = "greater"))
```


```{r}
#| label: distraction-output
#| eval: true
#| echo: false
ttest
```



## 4. Compare the statistic with the null distribution

- The test statistic value is $t_D = 2.91$.
- We are only interested in the probability that $T > 2.91$ under $\mathscr{H}_0$ (one-sided test).
- Use as null distribution a standard Student-_t_ distribution with 34 degrees of freedom, $T \sim \mathsf{Student}(34)$.
- The $0.05$ quantile of $T$ is $\mathfrak{t}_{0.05} = `r qt(0.05, 34)`$.


## 5. Obtain a *p*-value or a confidence interval

The _p_-value is $p = \Pr_0(T > t_D)$. Using **R**, we find $p=0.0032$, which is smaller than $\alpha=5\%$.

```{r}
#| eval: false
#| echo: true
pt(q = ttest$statistic, # value of T (2.91)
   df = ttest$parameter, # degrees of freedom (sample size minus 1)
   lower.tail = FALSE) # Probability of being above (not below)
```

```{r}
#| eval: true
#| echo: false
as.numeric(pt(q = ttest$statistic, # value of T (2.91)
   df = ttest$parameter, # degrees of freedom (sample size minus 1)
   lower.tail = FALSE)) # Probability of being above (not below)
```
The lower bound of the confidence interval is $\overline{D} + \mathsf{se}(\overline{D}) \times \mathfrak{t}_{0.05}$.

```{r}
#| eval: false
#| echo: true
ttest$estimate + ttest$stderr * qt(0.05, df = 34)
```
```{r}
#| eval: true
#| echo: false
as.numeric(ttest$estimate + ttest$stderr * qt(0.05, df = 34))
```
The one-sided confidence interval is $[`r as.numeric(ttest$conf.int)[1]`, \infty]$. The postulated null value, $0$, is outside the interval.

## 6. Conclude in the setting of the problem

We reject $\mathscr{H}_0$, meaning that the reaction time is significantly higher (at level $5$%) when texting than talking on the cellphone while walking.

The estimated mean difference is $`r ttest$estimate`$ seconds (std. error of `r ttest$stderr`).


## References

